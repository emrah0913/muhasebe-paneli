<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cariler - Atölye Yönetim Paneli</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css">
    <link rel="stylesheet" href="css/style.css">

    <script type="module">
        // ... index.html'deki ile aynı Firebase başlatma kodları ...
        const alpineScript = document.createElement('script');
        alpineScript.src = 'https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js';
        alpineScript.defer = true;
        document.head.appendChild(alpineScript);
    </script>
</head>
<body x-data="appState()" x-init="init()">

    <div x-show="!appReady" x-cloak class="flex items-center justify-center h-screen bg-gray-100">
        <p class="text-lg font-semibold text-gray-700">Yükleniyor...</p>
    </div>

    <div x-show="appReady" x-cloak class="flex h-screen bg-gray-100 font-sans no-print">
        <nav class="flex flex-col w-64 bg-gray-800 text-white">
            <div class="flex items-center justify-center h-20 border-b border-gray-700"><h1 class="text-2xl font-bold">Atölye Paneli</h1></div>
            <div class="flex-1 px-4 py-6 space-y-1">
                <a href="dashboard.html" x-show="userRole === 'admin'" class="flex items-center px-4 py-2 rounded-lg sidebar-link">Gösterge Paneli</a>
                <a href="cariler.html" class="flex items-center px-4 py-2 rounded-lg sidebar-link active">Cariler</a>
                <a href="siparisler.html" class="flex items-center px-4 py-2 rounded-lg sidebar-link">Siparişler</a>
                </div>
            <div class="mt-auto p-4 border-t border-gray-700"><button @click="signOut()" class="w-full text-left flex items-center px-4 py-2 rounded-lg sidebar-link">Çıkış Yap</button></div>
        </nav>

        <main class="flex-1 p-6 md:p-10 overflow-y-auto">
            
            <div x-show="!viewingCustomer" x-transition>
                <div class="flex justify-between items-center mb-6"><h2 class="text-3xl font-bold text-gray-800">Müşteriler</h2><button @click="openModal('newCustomer')" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg">Yeni Müşteri Ekle</button></div>
                <div class="mb-4"><input type="text" x-model="searchTerm" placeholder="Müşteri No, Ad veya Telefon ile Ara..." class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"></div>
                <div class="bg-white p-6 rounded-lg shadow-md overflow-x-auto">
                    <table class="w-full text-left">
                        <thead class="bg-gray-50"><tr><th class="p-3">No</th><th>Adı Soyadı</th><th>Telefon</th><th class="text-right">Bakiye</th><th>İşlemler</th></tr></thead>
                        <tbody>
                            <template x-for="customer in filteredCustomers" :key="customer.id"><tr class="border-b hover:bg-gray-50"><td class="p-3 font-mono font-bold" x-text="customer.id"></td><td x-text="customer.name"></td><td x-text="customer.phone"></td><td class="text-right font-semibold" :class="getCustomerBalance(customer.id).balance > 0 ? 'text-red-600' : 'text-green-600'" x-text="formatCurrency(getCustomerBalance(customer.id).balance)"></td><td><button @click="viewCustomerDetail(customer)" class="text-indigo-600 hover:underline">Detay</button> <button @click="deleteDocAndFiles('customers', customer.id.toString(), customer.projectFileUrl ? [customer.projectFileUrl] : [])" class="text-red-600 hover:underline ml-2">Sil</button></td></tr></template>
                            <tr x-show="filteredCustomers.length === 0"><td colspan="5" class="text-center p-6 text-gray-500">Müşteri bulunamadı.</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <template x-if="viewingCustomer">
                <div x-transition x-cloak>
                    <div class="mb-6"><a href="#" @click.prevent="viewingCustomer = null" class="text-indigo-600 hover:underline flex items-center">&larr; Müşteri Listesine Dön</a><h2 class="text-3xl font-bold text-gray-800 mt-2" x-text="viewingCustomer.name"></h2></div>
                    </div>
            </template>
            
        </main>
    </div>
    
    <div x-show="isModalOpen" x-cloak class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 no-print" @click.away="isModalOpen = false">
        <div class="bg-white rounded-lg shadow-xl p-6 md:p-8 w-full max-w-lg" @click.stop>
            <div x-show="modalType === 'newCustomer'"></div>
            <div x-show="modalType === 'newPayment'"></div>
        </div>
    </div>

    <script src="js/main.js" defer></script>
</body>
</html>
