<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Marangozhane YÃ¶netim Paneli</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen">

  <div class="max-w-3xl mx-auto mt-10 bg-white rounded-2xl shadow p-6">
    <h1 class="text-3xl font-bold text-center text-blue-600 mb-4">
      Marangozhane YÃ¶netim Paneli
    </h1>
    <p class="text-center text-gray-500 mb-6">Firebase ile gerÃ§ek zamanlÄ± iÅŸ ve aÅŸama takibi</p>

    <div class="text-center mb-6">
      <label class="mr-2 font-semibold">SimÃ¼le Edilen KullanÄ±cÄ±:</label>
      <select id="ustaSelect" class="border rounded-lg px-3 py-2 focus:ring focus:ring-blue-300">
        <option value="Mehmet">Mehmet (Usta)</option>
        <option value="Ahmet">Ahmet (Usta)</option>
        <option value="AyÅŸe">AyÅŸe (Usta)</option>
      </select>
    </div>

    <div id="ustaPaneli" class="bg-yellow-50 border border-yellow-300 rounded-lg p-4">
      <h2 id="ustaBaslik" class="text-lg font-semibold text-yellow-800 mb-2">
        Usta Paneli (Mehmet)
      </h2>
      <p class="text-sm text-yellow-700 mb-4">
        Sadece size atanan iÅŸlerin aÅŸama yÃ¼zdelerini anlÄ±k olarak gÃ¼ncelleyebilirsiniz.
      </p>

      <!-- Ä°ÅŸ listesi -->
      <div id="isListesi" class="space-y-3"></div>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, onValue, update } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    // ğŸ”§ Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyBCbKtD6jPE653IYwtTWo2fH93JXX4MN74",
      authDomain: "kibrissiparissistemi.firebaseapp.com",
      databaseURL: "https://kibrissiparissistemi-default-rtdb.firebaseio.com",
      projectId: "kibrissiparissistemi",
      storageBucket: "kibrissiparissistemi.firebasestorage.app",
      messagingSenderId: "263531733235",
      appId: "1:263531733235:web:82efdf39ed758a22465786",
      measurementId: "G-JK5S6L90Q5"
    };

    // ğŸš€ Firebase baÅŸlat
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const ustaSelect = document.getElementById("ustaSelect");
    const isListesi = document.getElementById("isListesi");
    const ustaBaslik = document.getElementById("ustaBaslik");

    // âœ… Usta seÃ§imi deÄŸiÅŸtiÄŸinde iÅŸleri gÃ¼ncelle
    ustaSelect.addEventListener("change", () => {
      const ustaAdi = ustaSelect.value;
      ustaBaslik.textContent = `Usta Paneli (${ustaAdi})`;
      isListesi.innerHTML = "";
      loadJobs(ustaAdi);
    });

    // âœ… Ä°ÅŸleri yÃ¼kle (Realtime Database)
    function loadJobs(ustaAdi) {
      try {
        const jobsRef = ref(db, "jobs");
        onValue(jobsRef, (snapshot) => {
          isListesi.innerHTML = "";

          if (!snapshot.exists()) {
            isListesi.innerHTML = `<p class="text-gray-500 text-sm">HenÃ¼z kayÄ±tlÄ± iÅŸ bulunmuyor.</p>`;
            return;
          }

          snapshot.forEach((child) => {
            const job = child.val();
            const jobId = child.key;

            if (job.usta === ustaAdi) {
              const jobEl = document.createElement("div");
              jobEl.className = "border border-gray-200 bg-white rounded-lg p-3 shadow-sm";

              jobEl.innerHTML = `
                <div class="flex justify-between items-center">
                  <div>
                    <p class="font-semibold text-gray-800">${job.isAdi}</p>
                    <p class="text-sm text-gray-500">Durum: ${job.durum || "Beklemede"}</p>
                  </div>
                  <div class="flex items-center">
                    <input type="number" id="progress-${jobId}" value="${job.yuzde || 0}" min="0" max="100"
                      class="border border-gray-300 rounded-md px-2 py-1 w-16 text-center">
                    <button class="ml-2 bg-blue-500 text-white px-3 py-1 rounded-md text-sm hover:bg-blue-600"
                      onclick="window.guncelleYuzde('${jobId}')">Kaydet</button>
                  </div>
                </div>
              `;
              isListesi.appendChild(jobEl);
            }
          });

          if (isListesi.innerHTML === "") {
            isListesi.innerHTML = `<p class="text-gray-500 text-sm">Bu ustaya atanmÄ±ÅŸ iÅŸ bulunmuyor.</p>`;
          }
        });
      } catch (err) {
        console.error("Firebase yÃ¼kleme hatasÄ±:", err);
        isListesi.innerHTML = `<p class="text-red-500 text-sm">Veriler yÃ¼klenemedi âŒ</p>`;
      }
    }

    // âœ… YÃ¼zde gÃ¼ncelleme fonksiyonu
    window.guncelleYuzde = async (jobId) => {
      try {
        const yuzdeInput = document.getElementById(`progress-${jobId}`);
        const yeniYuzde = parseInt(yuzdeInput.value);
        if (isNaN(yeniYuzde) || yeniYuzde < 0 || yeniYuzde > 100) {
          alert("LÃ¼tfen 0-100 arasÄ± geÃ§erli bir deÄŸer girin!");
          return;
        }
        const jobRef = ref(db, `jobs/${jobId}`);
        await update(jobRef, { yuzde: yeniYuzde });
        alert("âœ… AÅŸama yÃ¼zdesi gÃ¼ncellendi");
      } catch (err) {
        console.error("YÃ¼zde gÃ¼ncelleme hatasÄ±:", err);
        alert("âŒ GÃ¼ncelleme baÅŸarÄ±sÄ±z oldu");
      }
    };

    // ğŸ”„ BaÅŸlangÄ±Ã§ta Mehmet iÃ§in yÃ¼kle
    loadJobs("Mehmet");
  </script>
</body>
</html>
