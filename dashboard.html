<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Atölye Yönetim Paneli</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <link rel="stylesheet" href="https://rsms.me/inter/inter.css" />

  <!-- Firebase compat sürümleri -->
  <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-storage-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-functions-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBCbKtD6jPE653IYwtTWo2fH93JXX4MN74",
      authDomain: "kibrissiparissistemi.firebaseapp.com",
      projectId: "kibrissiparissistemi",
      storageBucket: "kibrissiparissistemi.appspot.com",
      messagingSenderId: "263531733235",
      appId: "1:263531733235:web:82efdf39ed758a22465786",
      measurementId: "G-JK5S6L90Q5"
    };

    firebase.initializeApp(firebaseConfig);

    const auth = firebase.auth();
    const db = firebase.firestore();
    const storage = firebase.storage();
    const functions = firebase.functions();

    window.auth = auth;
    window.db = db;
    window.storage = storage;
    window.functions = functions;

    window.fb = {
      onAuthStateChanged: auth.onAuthStateChanged.bind(auth),
      signOut: () => auth.signOut(),
      collection: db.collection.bind(db),
      doc: db.doc.bind(db),
      addDoc: (ref, data) => ref.add(data),
      setDoc: (ref, data) => ref.set(data),
      updateDoc: (ref, data) => ref.update(data),
      deleteDoc: (ref) => ref.delete(),
      query: firebase.firestore().query,
      orderBy: firebase.firestore().orderBy,
      serverTimestamp: firebase.firestore.FieldValue.serverTimestamp,
      ref: storage.ref.bind(storage),
      uploadBytes: (ref, file) => ref.put(file),
      getDownloadURL: (ref) => ref.getDownloadURL(),
      deleteObject: (ref) => ref.delete(),
      httpsCallable: functions.httpsCallable.bind(functions)
    };

    window.firebaseReady = true;
  </script>

  <style>
    [x-cloak] { display: none !important; }
    body { background-color: #f3f4f6; font-family: 'Inter', sans-serif; }
    .sidebar-link:hover { background-color: #374151; }
    .sidebar-link.active { background-color: #4f46e5; color: white; }
  </style>
</head>

<body x-data="appState()" x-init="init()" class="invisible" :class="{ 'visible': appReady }">
  <!-- Yükleniyor ekranı -->
  <div x-show="!appReady" class="flex items-center justify-center h-screen bg-gray-100">
    <div class="text-center">
      <p class="text-lg font-semibold text-gray-700">Yükleniyor...</p>
    </div>
  </div>

  <!-- Panel -->
  <div x-show="appReady" x-cloak class="flex h-screen">
    <nav class="w-64 bg-gray-800 text-white p-4">
      <h1 class="text-xl font-bold mb-6">Atölye Paneli</h1>
      <a href="#" @click.prevent="activeTab = 'dashboard'" class="block mb-2 sidebar-link px-3 py-2 rounded" :class="{ 'active': activeTab === 'dashboard' }">Gösterge</a>
      <a href="#" @click.prevent="activeTab = 'siparisler'" class="block mb-2 sidebar-link px-3 py-2 rounded" :class="{ 'active': activeTab === 'siparisler' }">Siparişler</a>
      <button @click="signOut()" class="mt-6 w-full text-left sidebar-link px-3 py-2 rounded">Çıkış Yap</button>
    </nav>

    <main class="flex-1 p-6 overflow-y-auto">
      <div x-show="activeTab === 'dashboard'">
        <h2 class="text-2xl font-bold text-gray-700 mb-4">Gösterge Paneli</h2>
        <p>Toplam müşteri sayısı: <span class="font-semibold text-indigo-600" x-text="customers.length"></span></p>
      </div>

      <div x-show="activeTab === 'siparisler'">
        <h2 class="text-2xl font-bold text-gray-700 mb-4">Siparişler</h2>
        <ul>
          <template x-for="order in orders" :key="order.id">
            <li class="mb-2 p-2 bg-white shadow rounded border border-gray-200">
              <strong x-text="order.product"></strong> – ₺<span x-text="order.price"></span>
            </li>
          </template>
        </ul>
      </div>
    </main>
  </div>

  <script>
    function appState() {
      return {
        appReady: false,
        activeTab: 'dashboard',
        customers: [],
        orders: [],

        init() {
          if (!window.firebaseReady) {
            setTimeout(() => this.init(), 100);
            return;
          }

          fb.onAuthStateChanged(window.auth, (user) => {
            if (user) {
              this.listenData();
              this.appReady = true;
            } else {
              window.location.href = "index.html";
            }
          });
        },

        listenData() {
          fb.collection(db, "customers").onSnapshot(snapshot => {
            this.customers = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
          });

          fb.collection(db, "orders").onSnapshot(snapshot => {
            this.orders = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
          });
        },

        signOut() {
          fb.signOut().then(() => {
            window.location.href = "index.html";
          });
        }
      };
    }
  </script>
</body>
</html>
