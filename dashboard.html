<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atölye Yönetim Paneli</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css">

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut, setPersistence, browserLocalPersistence } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";
        import { getFirestore, collection, onSnapshot, addDoc, updateDoc, deleteDoc, doc, setDoc, query, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL, deleteObject } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-storage.js";
        import { getFunctions, httpsCallable } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-functions.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBCbKtD6jPE653IYwtTWo2fH93JXX4MN74",
            authDomain: "kibrissiparissistemi.firebaseapp.com",
            projectId: "kibrissiparissistemi",
            storageBucket: "kibrissiparissistemi.appspot.com",
            messagingSenderId: "263531733235",
            appId: "1:263531733235:web:82efdf39ed758a22465786",
            measurementId: "G-JK5S6L90Q5"
        };

        const app = initializeApp(firebaseConfig);
        window.auth = getAuth(app);
        window.db = getFirestore(app);
        window.storage = getStorage(app);
        window.functions = getFunctions(app);
        window.fb = { onAuthStateChanged, signOut, collection, onSnapshot, addDoc, updateDoc, deleteDoc, doc, setDoc, query, orderBy, serverTimestamp, ref, uploadBytes, getDownloadURL, deleteObject, httpsCallable };
        window.firebaseReady = true; 

        setPersistence(window.auth, browserLocalPersistence)
          .catch((error) => { console.error("Oturum kalıcılığı ayarlanırken hata:", error); });
        
        console.log("Firebase başarıyla başlatıldı.");

        // DÜZELTME: Alpine.js'i manuel olarak, Firebase'den sonra yükle
        const alpineScript = document.createElement('script');
        alpineScript.src = 'https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js';
        alpineScript.defer = true;
        document.head.appendChild(alpineScript);
        console.log("Alpine.js yüklemesi manuel olarak tetiklendi.");
    </script>
    
    <style>
        [x-cloak] { display: none !important; }
        .invisible { visibility: hidden; }
        .visible { visibility: visible; }
        /* ... diğer stiller ... */
    </style>
</head>
<body x-data="appState()" x-init="init()" class="invisible" :class="{ 'visible': appReady }">

    <div x-show="!appReady" class="flex items-center justify-center h-screen bg-gray-100">
        <div class="text-center">
            <p class="text-lg font-semibold text-gray-700">Yükleniyor...</p>
            <p class="text-sm text-gray-500">Giriş durumu kontrol ediliyor.</p>
        </div>
    </div>

    <div x-show="appReady" x-cloak class="flex h-screen bg-gray-100 font-sans no-print">
        <nav class="flex flex-col w-64 bg-gray-800 text-white">
            </nav>

        <main class="flex-1 p-6 md:p-10 overflow-y-auto">
            </main>
    </div>
    
    <script>
    function appState() {
        return {
            // ... Tam ve Eksiksiz appState Fonksiyonu ...
        }
    }
</script>
</body>
</html>
