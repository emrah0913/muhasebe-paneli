<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Atölye Yönetim Paneli</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <link rel="stylesheet" href="https://rsms.me/inter/inter.css" />

  <!-- Firebase compat sürümleri -->
  <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-storage-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-functions-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBCbKtD6jPE653IYwtTWo2fH93JXX4MN74",
      authDomain: "kibrissiparissistemi.firebaseapp.com",
      projectId: "kibrissiparissistemi",
      storageBucket: "kibrissiparissistemi.appspot.com",
      messagingSenderId: "263531733235",
      appId: "1:263531733235:web:82efdf39ed758a22465786",
      measurementId: "G-JK5S6L90Q5"
    };

    firebase.initializeApp(firebaseConfig);
    window.auth = firebase.auth();
    window.db = firebase.firestore();
    window.storage = firebase.storage();
    window.functions = firebase.functions();

    window.fb = {
      onAuthStateChanged: firebase.auth().onAuthStateChanged,
      signOut: () => firebase.auth().signOut(),
      collection: firebase.firestore().collection.bind(firebase.firestore()),
      doc: firebase.firestore().doc.bind(firebase.firestore()),
      addDoc: (ref, data) => ref.add(data),
      setDoc: (ref, data) => ref.set(data),
      updateDoc: (ref, data) => ref.update(data),
      deleteDoc: (ref) => ref.delete(),
      query: firebase.firestore().query,
      orderBy: firebase.firestore().orderBy,
      serverTimestamp: firebase.firestore.FieldValue.serverTimestamp,
      ref: firebase.storage().ref.bind(firebase.storage()),
      uploadBytes: (ref, file) => ref.put(file),
      getDownloadURL: (ref) => ref.getDownloadURL(),
      deleteObject: (ref) => ref.delete(),
      httpsCallable: firebase.functions().httpsCallable.bind(firebase.functions())
    };

    window.firebaseReady = true;
  </script>

  <style>
    [x-cloak] { display: none !important; }
    body { background-color: #f3f4f6; font-family: 'Inter', sans-serif; }
    .invisible { visibility: hidden; }
    .visible { visibility: visible; }
    .sidebar-link:hover { background-color: #374151; }
    .sidebar-link.active { background-color: #4f46e5; color: white; }
    .stat-card {
      background-color: white;
      padding: 1.5rem;
      border-radius: 0.5rem;
      box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
    }
    .status-badge {
      padding: 4px 10px;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      white-space: nowrap;
    }
    @keyframes highlight {
      0% { background-color: #fefcbf; }
      100% { background-color: transparent; }
    }
    .highlight-new { animation: highlight 2s ease-out; }
  </style>
</head>

<body x-data="appState()" x-init="init()" class="invisible" :class="{ 'visible': appReady }">
  <div x-show="!appReady" class="flex items-center justify-center h-screen bg-gray-100">
    <div class="text-center">
      <p class="text-lg font-semibold text-gray-700">Yükleniyor...</p>
      <p class="text-sm text-gray-500">Lütfen bekleyin.</p>
    </div>
  </div>

  <div x-show="appReady" x-cloak class="flex h-screen bg-gray-100 font-sans no-print">
    <!-- Sidebar -->
    <nav class="flex flex-col w-64 bg-gray-800 text-white">
      <div class="flex items-center justify-center h-20 border-b border-gray-700">
        <h1 class="text-2xl font-bold">Atölye Paneli</h1>
      </div>
      <div class="flex-1 px-4 py-6 space-y-1">
        <a href="#" @click.prevent="activeTab = 'dashboard'" class="sidebar-link px-4 py-2 rounded-lg" :class="{ 'active': activeTab === 'dashboard' }">Gösterge Paneli</a>
        <a href="#" @click.prevent="activeTab = 'siparisler'" class="sidebar-link px-4 py-2 rounded-lg" :class="{ 'active': activeTab === 'siparisler' }">Siparişler</a>
        <a href="#" @click.prevent="activeTab = 'stok'" class="sidebar-link px-4 py-2 rounded-lg" :class="{ 'active': activeTab === 'stok' }">Stok</a>
        <!-- Diğer sekmeler burada -->
      </div>
      <div class="mt-auto p-4 border-t border-gray-700">
        <button @click="signOut()" class="w-full text-left sidebar-link px-4 py-2 rounded-lg">Çıkış Yap</button>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-1 p-6 md:p-10 overflow-y-auto">
      <div x-show="activeTab === 'dashboard'">
        <h2 class="text-3xl font-bold mb-6 text-gray-800">Gösterge Paneli</h2>
        <!-- Dashboard kartları -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
          <div class="stat-card">
            <h3 class="text-gray-500 font-semibold">TOPLAM MÜŞTERİ</h3>
            <p class="text-4xl font-bold text-indigo-600 mt-2" x-text="customers.length"></p>
          </div>
          <!-- Diğer kartlar -->
        </div>
      </div>
    </main>
  </div>

  <script>
    function appState() {
      return {
        appReady: false,
        activeTab: 'dashboard',
        customers: [],

        init() {
          if (!window.firebaseReady) {
            setTimeout(() => this.init(), 100);
            return;
          }

          fb.onAuthStateChanged(window.auth, (user) => {
            if (user) {
              this.setupRealtimeListeners();
              this.appReady = true;
            } else {
              window.location.href = "index.html";
            }
          });
        },

        setupRealtimeListeners() {
          fb.collection(window.db, "customers").onSnapshot((snapshot) => {
            this.customers = snapshot.docs.map((doc) => ({ id: doc.id, ...doc.data() }));
          });
        },

        signOut() {
          fb.signOut().then(() => {
            window.location.href = "index.html";
          });
        }
      };
    }
  </script>
</body>
</html>
